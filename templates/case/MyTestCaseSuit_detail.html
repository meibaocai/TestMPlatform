{% extends 'base.html' %}{% load staticfiles %}{% block title %}    首页-测试管理平台{% endblock %}{% block page_title %}    <ul class="breadcrumb">        <li>            <i class="icon-home"></i>            <a href="/index">Home</a>            <i class="icon-angle-right"></i>        </li>        <li><a href="/case/CaseSuitDetail/{{ all_suit.id }}/">我的工作台 > 查看执行集</a></li>    </ul>{% endblock %}{% block contend %}    <div class="row-fluid">        <div class="span5" style=" margin-left:-0px;margin-right:-10px;" >            <div class="control-group" style="padding-left:auto">                <form  action="/case/CaseSuitDetail/{{ all_suit.id }}/" method="get" class="form-inline" >                    <label class="control-label" style="font-size:12px" >等级:                        <select class="" id="case_jb"  name="case_jb" style="width:100px">                            <option value="">--选择级别--</option>                            <option value="Level0">Level0</option>                            <option value="Level1">Level1</option>                            <option value="Level2">Level2</option>                            <option value="Level3">Level3</option>                            <option value="Level4">Level4</option>                        </select>                    </label>                    <label class="control-label" style="margin-left: 0px;font-size:12px">状态:                        <select class="" id="case_status"  name="case_status" style="width:100px;">                            <option value="">--选择状态--</option>                            <option value="New">未执行</option>                            <option value="Pass">执行通过</option>                            <option value="Fail">执行失败</option>                            <option value="NG">无需执行</option>                            <option value="Block">执行阻塞</option>                        </select>                    </label>                    <button type="submit" id="sample_editable_1_new" class="btn green" style="margin-left: 2px;margin-top:2px;font-size:12px;"> 搜索 <i class="icon-search"></i></button>                </form>            </div>            <div class="portlet box grey" style="margin-right:5px;height:650px; overflow:scroll;">               <div class="portlet-title ">                    <div class="caption"><i class="icon-comments"></i>我的执行集</div>                    <div class="actions">                        <a href="javascript:void(0);" id="expand" class="btn yellow"> 展开节点</a>                    </div>                </div>                <div class="portlet-body fuelux" >                      <ul id="treeDemo" class="ztree"></ul>                      <input type="hidden" id="ztree_value"  value="">                </div>            </div>        </div>        <div class="span7" >            <div class="control-group" style="padding-left:auto">                <button type="button" class="btn blue" name="caseInfoSave" id="caseInfoSave" onclick="ChangeSuitCaseDetail()";>保存用例</button>                <button type="button" class="btn blue" name="executeNoNeed" id="executeNoNeed" onclick="ChangeCaseStatus('NG')";>无需执行</button>                <button type="button" class="btn red" name="executeStop" id="executeStop" onclick="ChangeCaseStatus('Block')";>执行阻塞</button>                <button type="button" class="btn red" name="executefailure" id="executefailure"  onclick="ChangeCaseStatus('Fail')";>执行失败</button>                <button type="button" class="btn blue" name="executeSucceed" id="executeSucceed"  onclick="ChangeCaseStatus('Pass')";>执行成功</button>            </div>            <div  id="SuitCase_detail" class="portlet-body" style="padding-top:0;padding-left:0px;">            </div>    </div>        </div>    </div>{% endblock %}{% block myjs %}<script>     $("#case_jb").val('{{ case_jb }}');     $("#case_status").val('{{ case_status }}');     var setting = {                view: {                    selectedMulti: false,                },                check: {                    enable: true                },                callback: {                    onClick: zTreeOnClick, //注册节点的点击事件                },                data: {                    simpleData: {                    enable: true                    }                    },                edit: {                enable: true,            }             };     //初始化数结果 初始化ztree     zTreeObj = $.fn.zTree.init($("#treeDemo"), setting, {{ Nodes|safe }});        //展开根节点    $('#expand').click(function () {            var zTree = $.fn.zTree.getZTreeObj("treeDemo");            var asyncForAll = false;            if (asyncForAll) {            zTree.expandAll(true);            }            else {            expandNodes(zTree.getNodes());            }        });        //展开根节点    function expandNodes(nodes) {            if (!nodes) return;            curStatus = "expand";            var zTree = $.fn.zTree.getZTreeObj("treeDemo");            for (var i=0, l=nodes.length; i<l; i++) {                zTree.expandNode(nodes[i], true, false, false);                if (nodes[i].isParent && nodes[i].zAsync) {                    expandNodes(nodes[i].children);                }            }        };        //点击节点的事件    function zTreeOnClick(event, treeId, treeNode) {            //这里根据节点ID获取对应信息或进行对应的操作            $.ajax({                    type: 'post',                    url: '/case/SuitCaseDetail',                    data: {                                "pId": treeNode.id,                                "suit_id" : {{ all_suit.id }},                            },                    timeout: 5000, //超时时间设置，单位毫秒                    beforeSend:function(xhr, settings){xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");},                    success: function (res) {                        $("#SuitCase_detail").html(res);                        $("#SuitCase_detail").show();                        //把treeNode.id传给ztree_value，用于更新用例执行状态                        document.getElementById('ztree_value').value=treeNode.id;                    }            });        };    function ChangeCaseStatus(case_status) {        //获取选中的ztree的节点id        var pId = $("#ztree_value").val();           $.ajax({                    type: 'post',                    url: '/case/ChangeCaseStatus',                    data: {                                "pId": pId,                                "suit_id" : {{ all_suit.id }},                                "case_status":case_status,                            },                    timeout: 5000, //超时时间设置，单位毫秒                    beforeSend:function(xhr, settings){xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");},                    success: function (res) {                        if(res.code==200)                        {                            //刷新用例执行状态框值                            document.getElementById('mcase_status').value=case_status;                        }                        else {                            alert(res.msg)                        }                    }            });    }    function ChangeSuitCaseDetail() {        //获取选中的ztree的节点id        var pId = $("#ztree_value").val();        var name =  $("#mcase_name").val();        var jb = $("#mcase_jb").val();        var precondition = $("#mcase_precondition").val();        var operation = $("#mcase_operation").val();        var expect_result = $("#mcase_expect_result").val();        var desc = $("#mcase_desc").val();        var remind = $("#mcase_remind").val();           $.ajax({                    type: 'post',                    url: '/case/ChangeCaseDetail',                    data: {                                "pId": pId,                                "suit_id" : {{ all_suit.id }},                                "name":name,                                "jb":jb,                                "precondition":precondition,                                "operation":operation,                                "expect_result":expect_result,                                "desc":desc,                                "remind":remind,                            },                    timeout: 5000, //超时时间设置，单位毫秒                    beforeSend:function(xhr, settings){xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");},                    success: function (res) {                        if(res.code==200)                        {                            //刷新用例执行状态框值                            alert(res.msg)                        }                        else {                            alert(res.msg)                        }                    }            });    }</script>{% endblock %}