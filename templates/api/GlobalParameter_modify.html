{% extends 'base.html' %}{% load staticfiles %}{% block title %}    首页-测试管理平台{% endblock %}{% block page_title %}    <ul class="breadcrumb">        <li>            <i class="icon-home"></i>            <a href="/index">Home</a>            <i class="icon-angle-right"></i>        </li>        <li><a href="/api/ModifyGParam/{{ all_parameter.id }}}">API自动化 >全局参数配置 >修改参数</a></li>    </ul>{% endblock %}{% block contend %}<div class="portlet-body form">    <!-- BEGIN FORM-->    <form action="/api/ModifyGParam/{{ all_parameter.id }}/" id="form_sample_1" class="form-horizontal"  method="post">        {% csrf_token %}        <div class="control-group">            <label class="control-label">参数名称<span class="required">*</span></label>            <div class="controls">                <input type="text" id="name" name="name" data-required="1" value="{{ all_parameter.name }}" class="span6 m-wrap">            </div>        </div>        <div class="control-group">            <label class="control-label">参数描述<span class="required">*</span></label>            <div class="controls">                <input type="text"id="desc" name="desc" data-required="1" value="{{ all_parameter.desc }}" class="span6 m-wrap">            </div>        </div>        <div class="control-group">            <label class="control-label">环境&参数类型<span class="required">*</span></label>            <div class="controls">                <select class="selectpicker" id="belong_env" name="belong_env"   multiple data-live-search="true" data-max-options="1"style="width:120px;" title="--请选环境--">                        {% for envs in all_env %}                            <option value="{{ envs.id }}"> {{ envs.env_name }}</option>                        {% endfor %}                </select>                <select class="selectpicker" id="param_type" name="param_type"   multiple data-live-search="true" data-max-options="1"style="width:120px;" title="--请选参数类型--">                        <option value="1"> KEY-VALUE类型</option>{#                        <option value="2">SQL类型</option>#}                        <option value="3">测试用例类型</option>                </select>            </div>        </div>        <div class="control-group"><div class="hr-line-dashed" style="border-top: 1px dashed lightgray;"></div></div>        <!-- key-value的隐藏div -->        <div id="key-value" class="control-group" style="display: none" >            <label class="control-label">参数值<span class="required">*</span></label>            <div class="controls">                <input type="text" id="value" name="value" value="{{ all_parameter.value}}" data-required="1" >            </div>        </div>        <!-- SQL类型的隐藏div -->        <div id="sql-div" class="control-group" style="display: none" >            <div class="control-group">            <label class="control-label">SQL语句<span class="required">*</span></label>                <div class="controls">                    <textarea rows="3"  class="span6 m-wrap" id="param_content" name="param_content">{{ all_parameter.param_content }}</textarea>                </div>            </div>            <div class="control-group">                <label class="control-label">返回值</label>                <div class="controls">                    <input type="text" id="sql_value" name="sql_value" value="{{ all_parameter.value }}"  placeholder="SQL运行后的值" disabled="disabled">                </div>            </div>        </div>        <!-- case-value的隐藏div -->        <div id="case-div" class="control-group" style="display: none" >            <div class="control-group">                <label class="control-label">选择用例<span class="required">*</span></label>                <div class="controls">                    <select class="selectpicker" multiple data-live-search="true" data-max-options="1"  name="related_case_id" id="related_case_id" title="--请选择用例--">                         <option value="">--请选择用例--</option>                        {% for apicase in all_apicase %}                           <option value="{{ apicase.id }}">{{ apicase.api_name }}</option>                       {% endfor %}                    </select>                </div>            </div>            <div class="form-group">                <table class="table table-bordered">                        <thead>                        <tr>                            <th>参数名</th>                            <th>值</th>                            <th>响应HeaderName</th>                            <th>响应CookieName</th>                            <th>JsonPath</th>                        </tr>                        </thead>                        <tbody>                        <tr>                            <td style="padding: 1px"><input type="text" id="parameter_name" name="parameter_name"  value="{{ all_parameter.name }}" disabled="disabled"></td>                            <td style="padding: 1px"><input type="text" id="parameter_name" name="parameter_name"  value="{{ all_parameter.value }}" disabled="disabled"></td>                            <td style="padding: 1px"><input type="text" id="param_header" name="param_header"></td>                            <td style="padding: 1px"><input type="text" id="param_cookie" name="param_cookie"></td>                            <td style="padding: 1px"><input type="text" id="param_path" name="param_path"></td>                        </tr>                        </tbody>                </table>            </div>        </div>        <div class="control-group" >            <H4  style="color: #1b23ff" align="center">{{ msg }}</H4>            <b style="color: #4b4cff">{% for key,error in ModifyGlobalParameter_Form.errors.items %}{{ key }}{{ error }}{% endfor %}</b>        </div>        <div class="form-actions">            <button type="submit" class="btn green ">确认</button>            <a href="{% url 'api:GlobalParameterList' %}">                <button type="button" class="btn" style="margin-left: 30px">取消</button>            </a>        </div>    </form>    <!-- END FORM--></div>{% endblock %}{% block myjs %}<script>     $(document).ready(function() {         //根据值让option选中         //根据服务端返回值让option选中         $("#belong_env").selectpicker('val', {{ all_parameter.belong_env.id|safe }});         $("#param_type").selectpicker('val', {{ all_parameter.param_type|safe }});         $("#related_case_id").selectpicker('val', {{ all_parameter.related_case.id|safe }});    var param_type = $("#param_type").val();    if  (param_type == "1"){        $("#key-value").show();        $("#sql-div").hide();        $("#case-div").hide();        return;    }    if  (param_type == "2") {        $("#key-value").hide();        $("#sql-div").show();        $("#case-div").hide();        return;    }    if (param_type == "3") {            $("#key-value").hide();            $("#sql-div").hide();            $("#case-div").show();            var param_content = eval({{ all_parameter.param_content|safe }});         //服务端后台返回到客户端的JSON格式字符串：var str = '[{"uname":"王强","day":"2010/06/17"},{"uname":"王海云","day":"2010/06/11"}]';         // 我们把它转换成JSON对象:var jsonList=eval("("+str+")");这时候如果以用断点跟踪查看这个jsonList对象，其实你会发现，他的长度为2，即jsonList.length=2。         // 它的每一项都是一个单独的JSON对象。https://www.cnblogs.com/xujie/archive/2010/07/16/1779087.html         //根据服务返回的值，设置check             var param_content_json = JSON.stringify(param_content);             var json_param_contentList = eval("(" + param_content_json + ")");             $("#param_header").val(json_param_contentList.param_header);             $("#param_cookie").val(json_param_contentList.param_cookie);             $("#param_path").val(json_param_contentList.param_path);            return;    } });    $("#param_type").change(function() {    var param_type = $("#param_type").val();    //alert(param_type)    if  (param_type == "1"){        $("#key-value").show();        $("#sql-div").hide();        $("#case-div").hide();        return;    }    if  (param_type == "2") {        $("#key-value").hide();        $("#sql-div").show();        $("#case-div").hide();        return;    }    if  (param_type == "3") {        var param_content = eval({{ all_parameter.param_content|safe }});        {#document.getElementById("param_header").value = param_content.param_header;#}        {#document.getElementById("param_cookie").value = param_content.param_cookie;#}        {#document.getElementById("param_path").value = param_content.param_path;#}        $("#key-value").hide();        $("#sql-div").hide();        $("#case-div").show();    }});</script>{% endblock %}