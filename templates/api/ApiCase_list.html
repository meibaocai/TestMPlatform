{% extends 'base.html' %}{% load staticfiles %}{% block title %}    首页-测试管理平台{% endblock %}{% block page_title %}    <ul class="breadcrumb">        <li>            <i class="icon-home"></i>            <a href="/index">Home</a>            <i class="icon-angle-right"></i>        </li>        <li><a href="{% url 'api:ApiCaseList' %}">API自动化 >Api接口用例管理</a></li>    </ul>{% endblock %}{% block contend %}    <div class="portlet-body">            {% csrf_token %}        <div class="clearfix">                <div class="btn-group">                                    <a href="{% url 'api:AddApiCase' %}">										<button id="sample_editable_1_new" class="btn green">										新增接口 <i class="icon-plus"></i>										</button>                                        </a>                                    <a href="#testAlert"  role="button" class="btn red"  data-toggle="modal" style="margin-left: 10px;">										删除接口 <i class="icon-minus"></i>                                    </a>                                    <button id="sample_editable_1_new" class="btn blue" style="margin-left: 10px;" onclick="RunAllCase()">										执行搜索出来的用例 <i class=" icon-ok"></i>                                    </button>                                     <a href="{% url 'api:RunApiPlanInfo' %}"  role="button" class="btn green"  data-toggle="modal" style="margin-left: 10px;">										CI执行报告 <i class="icon-ok"></i>                                    </a>                </div>                <form action="{% url 'api:ApiCaseList' %}"  class="form-inline"  method="get" enctype="multipart/form-data" style="margin-top:5px;" >                {% csrf_token %}                <label class="control-label"style="margin-left:0px" > 关键字:                    <input type="text" name="search_key" id="search_key"  placeholder="输入名称、Method搜索"  value="{{ search_key }}" style="width:150px;">                </label>                <label class="control-label" style="margin-left:15px">环境：                    <select class="selectpicker" id="select_env" name="select_env"  data-max-options="1"style="width:120px;" title="--请选环境--">                        <option value=""></option>                        {% for env in all_env %}                            <option value="{{ env.id }}">{{ env.env_name }}</option>                        {% endfor %}                    </select>                </label>                <label class="control-label" style="margin-left:15px">类型：                    <select class="selectpicker" id="select_type" name="select_type"  data-max-options="1"style="width:100px;" title="--请选择类型--">                        <option value=""></option>                        <option value="0">前后置操作	</option>                        <option value="1">CI</option>                        <option value="2">非CI</option>                        <option value="3">删除</option>                    </select>                </label>                 <label class="control-label" style="margin-left:15px">服务：                    <select class="selectpicker" id="select_service" name="select_service"  multiple data-live-search="true" data-max-options="1"style="width:100px;" title="--请选择服务--">                        <option value=""></option>                        {% for service in all_service %}                            <option value="{{ service.id }}">{{ service.name }}</option>                        {% endfor %}                    </select>                 </label>                <button type="submit" class="btn green "  style="margin-left:10px;">搜索</button>            </form>            </div>            <div id="testAlert" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel3" aria-hidden="true">                                <div class="modal-header">                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>                                    <h3 id="myModalLabel3">警告</h3>                                </div>                                <div class="modal-body">                                    <p>是否确定删除该接口</p>                                </div>                                <div class="modal-footer">                                    <button class="btn" data-dismiss="modal" aria-hidden="true">取消</button>                                    <input type="button" id="testDel" data-dismiss="modal" class="btn blue" value="确认">                                </div>            </div>            <table class="table table-striped table-bordered table-hover" id="sample_1">                <thead>                    <tr>                        <th style="width:8px;"><input type="checkbox" class="group-checkable" data-set="#sample_1 .checkboxes" /></th>                        <th>ID</th>                        <th>接口名称</th>                        <th>所属环境</th>                        <th>所属服务</th>                        <th class="hidden-480">Method</th>                        <th class="hidden-480">设计者</th>                        <th class="hidden-480">修改者</th>                        <th class="hidden-480">类型</th>                        <th class="hidden-480">修改时间</th>                    </tr>                </thead>                    <tbody>                        {% for case_info in pages %}                            <tr class="odd gradeX">                                    <td><input type="checkbox" class="checkboxes" value="{{ case_info.id }}" /></td>                                    <td class="hidden-480">{{  case_info.id }}</td>                                    <td class="hidden-480" style="color: #246ee5">                                        <a href="/api/ModifyApiCase/{{ case_info.id }}/">{{ case_info.api_name }}</a>                                    </td>                                    <td class="hidden-480">{{ case_info.belong_env.env_name }}</td>                                    <td class="hidden-480">{{ case_info.belong_service.name }}</td>                                    <td class="hidden-480">{{ case_info.api_method }}</td>                                    <td class="hidden-480">{{ case_info.designer }}</td>                                    <td class="hidden-480">{{ case_info.modifier}}</td>                                    <td class="hidden-480">{{ case_info.get_type_display }}</td>                                    <td class="hidden-480">{{ case_info.update_time }}</td>                            </tr>                        {% endfor %}                            <table class="table">                                <ul class="breadcrumb">                                    {% if pages.has_previous %}                                      <li class="long">                                        <a href="?search_key={{ search_key }}&select_env={{ select_env }}&select_service={{ select_service }}&select_type={{ select_type }}&page_num={{ pages.previous_page_number }}">上一页</a>                                      </li>                                  {% endif %}                                    {% for num in pages.paginator.page_range %}                                        <li {% if num == pages.number %}class="active" {% endif %}><a href="?search_key={{ search_key }}&select_env={{ select_env }}&select_service={{ select_service }}&select_type={{ select_type }}&page_num={{ num }}">{{ num }}</a></li>                                    {% endfor %}                                    {% if pages.has_next %}                                        <li class="long" >                                            <a href="?search_key={{ search_key }}&select_env={{ select_env }}&select_service={{ select_service }}&select_type={{ select_type }}&page_num={{ pages.next_page_number }}">下一页</a>                                        </li>                                    {% endif %}                                </ul>                            </table>                    </tbody>            </table>    </div>    {% endblock %}{% block myjs %}<script>        // 根据后台返回的数据，让环境下拉框选中    $("#select_env").selectpicker('val',"{{ select_env|safe }}" );    $("#select_service").selectpicker('val',"{{ select_service|safe }}" );    $("#select_type").selectpicker('val',"{{ select_type|safe }}" );    $("#testDel").on('click', function() {            check_val = [];            $(":checkbox:checked").each(function () {            if (this.value != '') {                check_val.push(this.value);            }            });            var checkValue = eval(check_val);            if (checkValue == '') {            alert("请选择一条记录");            window.location.reload()            return;            }            if (checkValue.length>1)            {                alert("只能选择一条记录");                window.location.reload()                return;            }            $.ajax({                type: 'POST',                url: '/api/DelApiCase',                data:{                    "api_id":checkValue[0],                },                beforeSend:function(xhr, settings){                    xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");                },                success: function (callback) {                        alert(callback.msg);                        window.location.reload()                }            });    });        //调用执行用例接口    function RunAllCase() {        var search_key = $('#search_key').val();        var select_env = $('#select_env').val();        var select_service = $('#select_service').val();        {#alert("正在执行，稍后请查阅CI执行报告！")#}        $.ajax({                    type: 'POST',                    url: '/api/RunAllCase/',                    traditional:true,                    async : true,                    data: {                        "search_key":search_key,                        "select_env":select_env,                        "select_service":select_service,                    },                    timeout: 5000000, //超时时间设置，单位毫秒                    beforeSend: function (xhr, settings) {                        xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");                        },                    success: function (res) {                         if (res.code == 200) {                           alert(res.msg);                               //window.location.reload()                       }                      else{                           alert("wwwwwwwwwwwww");                        }                    },                    error:function (e) {　　　　　　　　　　//返回500错误 或者其他 http状态码错误时 需要在error 回调函数中处理了 并且返回的数据还不能直接alert，需要使用　　　　　　　　　　//$.parseJSON 进行转译    res.msg 是自己组装的错误信息通用变量                        var res = $.parseJSON(e.responseText);                        //alert(res.msg)                        alert("33333333333")            }           });    }</script>{% endblock %}